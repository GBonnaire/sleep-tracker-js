!function(o,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):o.sleepTracker=e()}(this,function(){"use strict";return function(o){const e={},t=[];let n,i,a=!1;e.options=Object.assign({},o);const s={timeout:30,timeoutBeforeAsleep:2,detectActivity:!0,delayCallAwake:5,keyStorage:window.location.hostname+"_sleepTrackerDateWakedUp",onload:null,oninit:null,debug:!1};null==e.options&&(e.options={});for(let o in s)e.options.hasOwnProperty(o)&&null!=e.options[o]||(e.options[o]=s[o]);e.on=function(o,n){return t.push({event:o,callback:n}),e},e.asleep=function(){clearInterval(n),n=null,p(),l("asleep",e)},e.wakeup=function(){n&&clearInterval(n),a=!1,u(),n=setInterval(r,6e4),l("wakeup",e)},e.awake=function(){n&&(a&&(l("awakened",e),a=!1),c()>=e.options.delayCallAwake&&(u(),l("awake",e)))},e.isAwake=function(){return!!n};const l=function(o){let n,i=Array.from(arguments);i.shift(),e.options.debug&&console.log("sleepTracker *DEBUG*",o,i);for(let e=0;e<t.length;e++){const a=t[e];if(a.event.toLowerCase()===o.toLowerCase()&&"function"==typeof a.callback){const o=a.callback.apply(this,i);void 0!==o&&(n=o)}}return n},r=function(){const o=c();a&&o<i?e.awake():o>=e.options.timeout?e.asleep():0==a&&e.options.timeout-o<=e.options.timeoutBeforeAsleep&&(a||(a=!0,!0===l("beforeasleep",e)&&e.awake())),i=o},c=function(){const o=Date.now()-d();return Math.round(o/1e3/60)},u=function(){window.localStorage.setItem(e.options.keyStorage,Date.now())},p=function(){window.localStorage.setItem(e.options.keyStorage,-1)},d=function(){return window.localStorage.getItem(e.options.keyStorage)};return e.options.oninit&&"function"==typeof e.options.oninit&&e.on("init",e.options.oninit),e.options.onload&&"function"==typeof e.options.onload&&e.on("load",e.options.onload),e.options.detectActivity&&(window.addEventListener("focus",e.awake),window.addEventListener("scroll",e.awake),window.addEventListener("keyup",e.awake)),l("init",e),window.addEventListener("DOMContentLoaded",function(){e.wakeup(),l("load",e)}),e}});