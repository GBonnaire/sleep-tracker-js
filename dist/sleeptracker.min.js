/**
 * Component Sleep Tracker
 * @version 1.0.2
 * @author GBonnaire <contact@gbonnaire.fr>
 * @website www.gbonnaire.fr
 * @license MIT
 * @description
 * Check if user is asleep behind computer include the management with several pages opended
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.sleepTracker=e()}(this,function(){"use strict";let t=function(t){let e={},o=[],n,i,a=!1,l=-1;e.options=Object.assign({},t);let r={timeout:30,timeoutBeforeAsleep:2,detectActivity:!0,delayCallAwake:5,keyStorage:window.location.hostname+"_sleepTrackerDateWakedUp",onload:null,oninit:null,debug:!1};for(let s in null==e.options&&(e.options={}),r)e.options.hasOwnProperty(s)&&null!=e.options[s]||(e.options[s]=r[s]);e.on=function(t,n){return o.push({event:t,callback:n}),e},e.asleep=function(){clearInterval(n),n=null,w(),c("asleep",e)},e.wakeup=function(){n&&clearInterval(n),a=!1,k(),n=setInterval(f,6e4),c("wakeup",e)},e.awake=function(){n&&(a&&(c("awakened",e),a=!1),d()>=e.options.delayCallAwake&&(k(),c("awake",e)))},e.isAwake=function(){return!!n};let u=function(){e.wakeup(),c("load",e)},c=function(t){let n=Array.from(arguments);n.shift(),e.options.debug&&console.log("sleepTracker *DEBUG*",t,n);let i;for(let a=0;a<o.length;a++){let l=o[a];if(l.event.toLowerCase()===t.toLowerCase()&&"function"==typeof l.callback){let r=l.callback.apply(this,n);void 0!==r&&(i=r)}}return i},p=function(){if(a)return;a=!0;let t=c("beforeasleep",e);!0===t&&e.awake()},f=function(){let t=d();a&&t<i?e.awake():t>=e.options.timeout?e.asleep():!1==a&&e.options.timeout-t<=e.options.timeoutBeforeAsleep&&p(),i=t},d=function(){let t=Date.now()-y();return Math.round(t/1e3/60)},k=function(){try{window.localStorage.setItem(e.options.keyStorage,Date.now())}catch(t){l=Date.now()}},w=function(){try{window.localStorage.setItem(e.options.keyStorage,-1)}catch(t){l=-1}},y=function(){try{return window.localStorage.getItem(e.options.keyStorage)}catch(t){return l}};return e.options.oninit&&"function"==typeof e.options.oninit&&e.on("init",e.options.oninit),e.options.onload&&"function"==typeof e.options.onload&&e.on("load",e.options.onload),e.options.detectActivity&&(window.addEventListener("focus",e.awake),window.addEventListener("scroll",e.awake),window.addEventListener("keyup",e.awake)),c("init",e),window.addEventListener("DOMContentLoaded",u),e};return t});